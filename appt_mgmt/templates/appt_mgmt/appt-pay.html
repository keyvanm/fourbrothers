{% extends 'base.html' %}
{% load staticfiles %}
{% load bootstrap3 %}

{% block title %}Confirm and pay{% endblock %}

{% block content %}
    <form method="post" action="">
        {% csrf_token %}
        <div class="page-header">
            <h1>Pay for your order</h1>
        </div>

        <div class="panel panel-primary">
            <div class="panel-heading">
                <h3 class="panel-title">
                    Your total is C$<span id="total-before-tax">{{ total_price_before_tax }}</span> + C${{ total_tax }} (13% HST) + C$<span id="grat-amount">{{ total_gratuity }}</span> (<span id="grat-perc">{{ appt.gratuity }}%</span> Gratuity) = C$<span id="total">{{ total_price_after_gratuity }}</span>
                </h3>
            </div>
            <div class="panel-body">
                <ul class="list-unstyled">
                    {% for serviced_car in appt.servicedcar_set.all %}
                        <li>
                            {{ serviced_car.car }}
                            <ul>
                                {% for service in serviced_car.services.all %}
                                    <li>
                                        {{ service }} (C${{ service.fee }})
                                    </li>
                                {% endfor %}
                            </ul>
                        </li>
                    {% endfor %}
                </ul>
                <ul class="list-unstyled">
                    <li>
                        Gratuity:
                        <select name="gratuity" id="grat">
                            {% for grat in gratuity.choices %}
                                <option {% if grat.0 == 10 %} selected="selected" {% endif %} value="{{ grat.0 }}">{{ grat.1 }}</option>
                            {% endfor %}
                        </select>
                    </li>
                </ul>
                <a href="{% url 'homepage' %}" class="btn btn-default">Cancel</a>
                {#                <input class="btn btn-primary" type="submit" value="Pay"/>#}
                <script
                        src="https://checkout.stripe.com/checkout.js" class="stripe-button"
                        data-key="{{ stripe_public_key }}"
                        data-amount="5"
                        data-name="FourBrothers"
                        data-description="$5"
                        {#                        data-image="https://s3.amazonaws.com/stripe-uploads/acct_14sgA4LTjRqtW0Rpmerchant-icon-1414533378555-fb_logo.png"#}
                        data-zip-code="true"
                        data-currency="CAD"
                        data-email="{{ user.email }}">
                </script>
            </div>
            <div class="panel-footer">All prices are in Canadian Dollars (CAD)</div>
        </div>

    </form>
{% endblock %}